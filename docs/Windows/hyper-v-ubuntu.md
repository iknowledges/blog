# Hyper-V安装Ubuntu虚拟机

## 启用Hyper-V

1. 打开【控制面板】->【程序】->【启用或关闭Windows功能】，勾选Hyper-V（包括Hyper-V管理工具和Hyper-V平台），然后按提示重启电脑。

2. 打开Hyper-V管理器，选择本机的虚拟化服务器，打开【操作】->【Hyper-V设置】

- 【虚拟机硬盘】设置为：D:\VM\Virtual Hard Disks\
- 【虚拟机】设置为：D:\VM\Hyper-V\

## 安装Ubuntu虚拟机

1. 【新建】->【虚拟机】，打开新建虚拟机向导页面。
2. 【指定名称和位置】：填写虚拟机名称。
3. 【指定代数】：选择【第二代】。
4. 【分配内存】：填写启动内存，勾选【为此虚拟机使用动态内存】。
5. 【配置网络】：选择【Default Switch】。
6. 【连接虚拟硬盘】：选择【创建虚拟硬盘】，并设置合适大小。
7. 【安装选项】：选择下载好的ISO映像文件。
8. 点击完成后打开虚拟机的【设置】->【安全】，取消勾选【启用安全启动】。
9. 最后点击【连接】->【启动】，开始安装虚拟机系统。

## 设置桥接网络（不推荐）

1. 【虚拟交换机管理】->【新建虚拟网络交换机】，开始创建虚拟交换机。
2. 选择【外部】，点击【创建虚拟交换机】。
3. 选择【外部网络】，选择网卡，勾选【允许管理操作系统共享此网络适配器】，名称可以自定义，如Bridge。
4. 打开已创建虚拟机的【设置】，在【网络适配器】下将【虚拟交换机】设置为上面创建的Bridge，最后点击【确定】。

## 配置双网卡

- 一、创建内部虚拟交换机

1. 打开【虚拟交换机管理】->【新建虚拟网络交换机】，名称填入MySwitch，选择【内部】，点击【确定】创建虚拟交换机。
2. 然后打开【网络和共享中心】，点击【更改适配器设置】，找到刚刚创建的MySwitch虚拟网卡，将其IPv4地址改为：192.168.100.1，子网掩码改为：255.255.255.0。
3. 打开虚拟机的【设置】->【添加硬件】，选择【网络适配器】，点击添加，【虚拟交换机】选择MySwitch，然后确认并重启电脑。

- 二、虚拟机内设置两块网卡的网络配置

1. 使用命令`ip a`查看网卡名称，比如Default Switch对应网卡名称为eth0，而MySwitch对应的网卡名称为eth1。
2. 然后修改配置文件`/etc/netplan/01-network-manager-all.yaml`如下：

```yaml
network:
  ethernets:
    eth0:
      dhcp4: true
    eth1:
      dhcp4: false
      addresses: [192.168.100.2/24]
  version: 2
  renderer: NetworkManager
```

其中/24表示子网掩码为255.255.255.0

3. 使配置生效

```
sudo netplan apply
```

#### 参考资源

- [关于Hyper-V网络设置经验总结（Default Switch/固定IP/SSH）](https://bbs.huaweicloud.com/blogs/324280)
