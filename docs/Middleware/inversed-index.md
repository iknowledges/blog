# 倒排索引的原理

## 概念

倒排索引：“关键词”=>“文档ID”，即关键词到文档ID的映射。

## 倒排索引的基本数据结构

原始数据表：

|id|product|describe|
|---|---|---|
|1|新款小米手机|手机中的战斗机|
|2|小米NFC手机|支持全功能NFC|
|3|NFC手机|-|
|4|小米耳机|-|
|5|红米耳机|-|
|...|...|...|
|10Y|扫地机器人|扫拖一体|

倒排索引：

|term index|term dictionary|posting list|
|---|---|---|
||小米|1,2,...,100w|
||手机|1,2,3|
||NFC|2,3|
||耳机|4,5|

倒排索引包括三个数据结构：

1. 词项索引(term index)：是辅助检索词项的一个结构，当词项字典很大时可以快速地查找到词项。底层结构时FST，前缀树Trie的一种变体。
2. 词项字典(term dictionary)：存储着非重复的词项数据，如上表中记录着原始数据中product字段被拆分后的词项。
3. 倒排表(posting list)：是一个有序数组，包含这个词项在原始数据中所有id的集合。当数据量很大时会用到两种压缩算法：Roaring Bitmaps和Frame Of Reference。

### Elasticsearch中的索引文件

- .tip文件：对应词项索引，存储FST的公共前缀和公共后缀的指针。
- .tim文件：对应词项字典，存储倒排表的指针。
- .doc文件：对应倒排表。

#### 参考资源

- [倒排索引的核心原理](https://www.bilibili.com/video/BV1Xa4y1G7ry)